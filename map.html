<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Displacement Pathways / Шляхи Переміщення</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --blue: #00aeef;
            --red: #e2231a;
            --yellow: #ffb500;
            --purple: #8e44ad;
            --green: #27ae60;
            --bg: #f0f2f5;
            --panel-width: 400px;
            --header-bg: rgba(255, 255, 255, 0.95);
        }

        body {
            margin: 0;
            background-color: var(--bg);
            font-family: 'Segoe UI', Helvetica, Arial, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            touch-action: none;
        }

        /* --- FLOATING HEADER --- */
        .floating-header {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 380px;
            background: var(--header-bg);
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            z-index: 50;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.5);
        }

        .header-logo {
            width: 100%;
            height: auto;
            max-height: 150px;
            object-fit: contain;
            object-position: left;
            margin-bottom: 15px;
        }

        .header-title {
            font-size: 18px;
            font-weight: 700;
            color: #2c3e50;
            margin: 0 0 15px 0;
            line-height: 1.3;
        }

        .lang-switch {
            display: flex;
            background: #e0e6ed;
            border-radius: 8px;
            padding: 4px;
            width: fit-content;
        }

        .lang-btn {
            border: none;
            background: transparent;
            padding: 6px 16px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            color: #7f8c8d;
            transition: all 0.2s;
        }

        .lang-btn.active {
            background: white;
            color: var(--blue);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* --- VIEWPORT --- */
        #viewport {
            width: 100%;
            height: 100%;
            cursor: grab;
            position: relative;
        }
        #viewport:active { cursor: grabbing; }

        #transform-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
        }

        #svg-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 5000px;
            height: 5000px;
            pointer-events: none;
            z-index: 0;
            overflow: visible;
        }

        .edge {
            fill: none;
            stroke: #bdc3c7;
            stroke-width: 2.5px;
            stroke-linejoin: round;
            stroke-linecap: round;
        }
        .edge.dotted { stroke-dasharray: 6, 4; }

        /* --- NODES --- */
        .node {
            position: absolute;
            width: 180px;
            padding: 12px 10px;
            border-radius: 12px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            z-index: 1;
            transition: transform 0.2s, box-shadow 0.2s;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 54px;
            box-sizing: border-box;
            background: #fff;
        }

        .node:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
            z-index: 10;
        }

        .node.blue { background: linear-gradient(135deg, #00aeef, #008bc0); }
        .node.red { background: linear-gradient(135deg, #e2231a, #b91c14); }
        .node.yellow { background: linear-gradient(135deg, #ffb500, #e5a200); color: #222; }
        .node.purple { background: linear-gradient(135deg, #8e44ad, #71368a); }
        .node.wide { width: 400px; }

        /* --- SIDE PANEL --- */
        .panel {
            position: fixed;
            right: 0;
            top: 0;
            width: var(--panel-width);
            height: 100%;
            background: white;
            box-shadow: -5px 0 30px rgba(0,0,0,0.15);
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            z-index: 100;
            display: flex;
            flex-direction: column;
        }
        .panel.open { transform: translateX(0); }

        .panel-header {
            padding: 25px;
            background: #fff;
            border-bottom: 1px solid #eee;
            flex-shrink: 0; /* Don't shrink header */
        }

        .panel-tag {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 10px;
            background: #95a5a6;
        }

        .panel-title {
            margin: 0;
            color: #2c3e50;
            font-size: 22px;
            line-height: 1.3;
        }

        .panel-body {
            padding: 25px;
            overflow-y: auto;
            background: #fafafa;
            flex-grow: 1;
            color: #333; /* Explicit text color */
        }

        /* Info Boxes */
        .info-box {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.6;
            border-left: 5px solid transparent;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            color: #444; /* Ensure text is dark */
        }

        .info-box h4 {
            margin: 0 0 10px 0;
            font-size: 12px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.9;
            color: inherit;
        }

        .box-issue {
            background: #fff5f5;
            color: #c0392b;
            border-left-color: var(--red);
        }

        .box-action {
            background: #f0fbf4;
            color: #27ae60;
            border-left-color: var(--green);
        }

        .box-context {
            background: #fff;
            color: #555;
            border-left-color: #95a5a6;
            border: 1px solid #eee;
            border-left-width: 5px;
        }

        .close-btn {
            position: absolute; top: 20px; right: 20px;
            background: #f0f2f5; border: none;
            width: 36px; height: 36px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: #7f8c8d; transition: all 0.2s;
        }
        .close-btn:hover { background: #e2e6ea; color: #2c3e50; }

        /* --- CONTROLS --- */
        .controls {
            position: fixed;
            bottom: 30px;
            left: 30px;
            display: flex;
            gap: 10px;
            z-index: 90;
        }
        .btn {
            width: 45px; height: 45px;
            border-radius: 50%;
            border: none;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer; font-size: 16px; color: #555;
            transition: transform 0.1s;
        }
        .btn:hover { transform: scale(1.1); }

        /* --- MOBILE --- */
        @media (max-width: 768px) {
            .floating-header { width: calc(100% - 40px); top: 20px; left: 20px; padding: 15px; }
            .header-logo { height: 40px; }
            .header-title { font-size: 16px; }
            .panel {
                top: auto; bottom: 0; width: 100%; height: 70vh;
                transform: translateY(100%);
                border-radius: 20px 20px 0 0;
            }
            .panel.open { transform: translateY(0); }
        }
    </style>
</head>
<body>

<!-- HEADER -->
<div class="floating-header">
    <img src="https://i.ibb.co/tTknCBGz/Slide1.png" alt="Logo" class="header-logo">
    <h1 id="headerTitle" class="header-title">A <span style="color: rgb(0, 195, 255);">Child's</span> Journey - HNRP IDP Journey Map</h1>
    <div class="lang-switch">
        <button class="lang-btn active" onclick="setLanguage('en')">EN</button>
        <button class="lang-btn" onclick="setLanguage('uk')">UA</button>
    </div>
</div>

<!-- CANVAS -->
<div id="viewport">
    <div id="transform-layer">
        <!-- SVG Layer for Lines -->
        <svg id="svg-layer">
            <defs>
                <marker id="arrow" markerWidth="4" markerHeight="4" refX="4" refY="2" orient="auto" markerUnits="strokeWidth">
                    <path d="M0,0 L0,4 L4,2 z" fill="#bdc3c7" />
                </marker>
            </defs>
        </svg>
        <!-- Node Container -->
        <div id="node-container"></div>
    </div>
</div>

<!-- ZOOM CONTROLS -->
<div class="controls">
    <button class="btn" onclick="zoom(1.2)"><i class="fas fa-plus"></i></button>
    <button class="btn" onclick="zoom(0.8)"><i class="fas fa-minus"></i></button>
    <button class="btn" onclick="fitToScreen()"><i class="fas fa-expand"></i></button>
</div>

<!-- SIDE PANEL -->
<div id="sidePanel" class="panel">
    <button class="close-btn" onclick="closePanel()"><i class="fas fa-times"></i></button>
    <div class="panel-header">
        <span id="pTag" class="panel-tag">Tag</span>
        <h2 id="pTitle" class="panel-title">Title</h2>
    </div>
    <div id="pBody" class="panel-body">
        <!-- Content injects here -->
    </div>
</div>

<script>
    let currentLang = 'en';
    let scale = 1, pX = 0, pY = 0;

    // --- DATA ---
    const data = [
        {
            id: 'n1', x: 700, y: 50, w: 180, type: 'blue',
            content: {
                en: { label: 'Pre-crisis life', tag: 'Journey', context: 'Normal Development Context', actions: '• Children in stable family/community settings<br>• Regular school attendance<br>• Social connections and play for child growth<br>• Access to healthcare and social services' },
                uk: { label: 'Життя до кризи', tag: 'Подорож', context: 'Контекст нормального розвитку', actions: '• Діти у стабільних сімейних/соціальних умовах<br>• Регулярне відвідування школи<br>• Соціальні зв’язки та ігри для розвитку дитини<br>• Доступ до медичних та соціальних послуг' }
            }
        },
        {
            id: 'n2', x: 700, y: 180, w: 180, type: 'red',
            content: {
                en: { label: 'Conflict exposure & Initial Trauma', tag: 'High Risk Stage', issues: '<b>Immediate Risks</b><br>• Direct exposure to violence and hostilities<br>• Explosive ordnance and drone attacks<br>• 3,798 educational institutions damaged<br>• 1,109km of water networks, 82 water pumping stations, 12 water treatment plants, and 327 km of sewage networks damaged or destroyed<br>• Acute psychological trauma<br><b>Critical Needs</b><br>• Immediate physical safety<br>• Psychosocial first aid<br>• Age-appropriate crisis information<br>• Access to safe learning /catchup learning<br>• Safe water and heating<br>• Safe medical and health care', actions: '<b>Response Interventions</b><br> <b>Advocacy and Joint Prevention Plan</b><br>• End attacks on civilian infrastructure (3,798 schools damaged)<br>• Cease use of explosive weapons in populated areas<br>• Avoid impact on caused through damage of educational facilities and health facilities<br><br><b>Educational Continuity</b><br>• Safe learning spaces in conflict-affected areas<br>• Mobile education services<br>• Psychosocial support integrated in schools and learning spaces'},
                
                uk: { label: 'Вплив конфлікту', tag: 'Високий ризик', issues: '<b>Негайні ризики</b><br>• Пряме вплив насильства і ворожих дій<br>• Вибухові боєприпаси і атаки дронів<br>• 3798 навчальних закладів пошкоджено<br>• 1109 км водопровідних мереж, 82 водонапірні станції, 12 водоочисних станцій і 327 км каналізаційних мереж пошкоджено або зруйновано<br>• Гостра психологічна травма<br><b>Нагальні потреби</b><br>• Безпека<br>• Перша психологічна допомога<br>• Кризова інформація, відповідна віку<br>• Доступ до безпечного навчання/надолуження освітніх втрат<br>• Доступ до якісної води та опалення<br>• Доступ до медичних послуг та охорона здоров`я', actions: '<b>Заходи з реагуванню</b><br><b>Адвокація та спільний план запобігання</b><br>• Припинення атак на цивільну інфраструктуру (пошкоджено 3798 шкіл)<br>• Припинити використання вибухонебезпечних предметів у населених районах<br>• Уникати наслідків, спричинених пошкодженням навчальних закладів та медичних установ<br><br><b>Безперервність освіти</b><br>• Безпечні місця для навчання в районах, що постраждали від конфлікту<br>• Мобільні освітні послуги<br>• Психосоціальна підтримка, інтегрована в школи та місця для навчання' }
            }
        },
        {
            id: 'n3', x: 700, y: 310, w: 180, type: 'yellow',
            content: {
                en: { label: 'Evacuation', tag: 'Decision Point', context: '<b>Key Factors</b><br>• Mandatory evacuation orders<br>• Family capacity for self-organized movement including funds<br>• Availability of transportation<br>• Destination options (including availability of humanitarian assistance) and support networks <br><br><b>Child-Specific Considerations</b><br>• Separation from caregivers during evacuation<br>• Special needs for children with disabilities<br>• Comfort items and continuity needs<br>• Separation from learning peers and familiar teachers'},
                uk: { label: 'Евакуація', tag: 'Точка прийняття рішення', context: '<b>Ключові фактори</b><br>• Обов`язкові накази про евакуацію<br>• Здатність сім`ї самостійно організувати евакуацію, включаючи наявність фінансових коштів<br>• Наявність транспорту<br>• Можливі варіанти кінцевих пунктів евакуації (включаючи наявність гуманітарної допомоги) та мережі підтримки <br><br><b>Особливі фактори, що стосуються дітей</b><br>• Розлука з опікунами під час евакуації<br>• Особливі потреби дітей з інвалідністю<br>• Предмети для комфорту та постійних потреб<br>• Розлука з однолітками та знайомими вчителями'}
            }
        },
        {
            id: 'n4', x: 200, y: 440, w: 180, type: 'purple',
            content: {
                en: { label: 'Occupied Territories', tag: 'OT/RF', issues: '<b>Children in Occupied Territories/Russian Federation</b><br><b>Grave Violations</b><br>• Documented cases of transfer of Ukrainian children to Russia, including change in names and nationality<br>• Challenging tracing and family reunification<br>•Cases child recruitment through online content with recruitment propaganda<br>• Limited humanitarian access<br><b>Humanitarian challenges</b><br>• Exposure to explosive weapons,displacement<br>• Water crisis, lack of access to health, education<br> •High risk of outbreaks, infection diseases, waterborne diseases', actions: '<b>Response</b><br><b>Humanitarian Access</b><br>• Negotiate safe humanitarian corridors<br><b>Return and Reintegration</b><br>• Cross Border Family reunification<br>• Reintegration assistance in Ukraine<br><b>Monitoring and Reporting (CAAC)</b><br><b>Humanitarian assistance</b><br>• MHPSS, case management, EORE<br>• Access to health, water, basic NFI support including for winter' },
                uk: { label: 'Окуповані території', tag: 'ТОТ/РФ', issues: '<b>Діти на окупованих територіях/Російська Федерація</b><br><b>Серйозні порушення</b><br>• Задокументовані випадки перевезення українських дітей до Росії, включаючи зміну імен та громадянства<br>• Складність пошуку та возз`єднання сімей<br>• Випадки вербування дітей через онлайн-контент з пропагандою вербування<br>• Обмежений гуманітарний доступ<br><b>Гуманітарні виклики</b><br>• Рикизи повязані з вибуховою зброєю, та переміщенням<br>• Водна криза, відсутність доступу до охорони здоров`я, освіти<br>• Високий ризик спалахів інфекційних захворювань, захворювань, що передаються через воду', actions: '<b>Реагування</b><br><b>Гуманітарний доступ</b><br>• Переговори щодо безпечних гуманітарних коридорів<br><b>Повернення та реінтеграція</b><br>• Транскордонне возз`єднання сімей<br>• Допомога в реінтеграції в Україні<br><b>Моніторинг та звітність (CAAC)</b><br><b>Гуманітарна допомога</b><br>• ПЗПСП, кейс-менеджмент, інформування щодо ВНП<br>• Доступ до охорони здоров`я, води, базової підтримки в натуральному вигляді, в т.ч. зимової' }
            }
        },
        {
            id: 'n5', x: 450, y: 440, w: 180, type: 'red',
            content: {
                en: { label: 'Frontline children', tag: 'High Risk Stage', issues: '<b>Children Remaining in Frontline Areas</b><br><br><b>Hidden Population</b><br>• Families deliberately hide children from evacuation orders<br>•Children not visible (invisible children) in official evacuation data<br>• Family returning to frontlines after evacuation due to lack of support<br>• Self-imposed confinement due to security risks<br><b>Extreme Risks</b><br>• Constant exposure to drones and shelling<br>• Limited access to education, healthcare, social services, basic needs'},
                uk: { label: 'Діти на лінії фронту', tag: 'Високий ризик', issues: '<b>Діти, які залишаються в прифронтових районах</b><br><br><b>Приховане населення</b><br>• Сім`ї навмисно приховують дітей від евакуаційних заходів<br>• Діти, яких не видно (невидимі діти) в офіційних даних про евакуацію<br>• Сім`ї, які повертаються в прифронтові райони після евакуації через відсутність підтримки<br>• Самоізоляція через ризики для безпеки<br><b>Екстремальні ризики</b><br>• Постійна небезпека від безпілотників і обстрілів<br>• Обмежений доступ до освіти, охорони здоров`я, соціальних послуг, та покриття базових потреб' }
            }
        },
        {
            id: 'n6', x: 950, y: 440, w: 180, type: 'blue',
            content: {
                en: { label: 'Evacuation Process', tag: 'Journey', context: 'Evacuation Implementation<br><br><b>Process Types</b><br>• Evacuations conducted by humanitarian actors and State actors<br>• Organized evacuations through transit centers<br>• Self-managed family evacuations<br>• Emergency evacuations during active hostilities', actions: '<b>Child-Friendly Evacuation Support</b><br><b>Keeping Families Together</b><br>• Prevent family separation during evacuation<br>• Joint evacuation planning for families<br>• Social workforce engaged and supported at different points of journey<br><br><b>Specialized Support</b><br>• Accessible transport for children with disabilities<br>• Emergency care arrangements for unaccompanied children<br><br><b>Child Protection Measures</b><br>• Family tracing during evacuation<br>• Special transport for children with disabilities<br>• Child-friendly evacuation procedures<br>• Provision of MPCA for families with children<br>• Age-appropriate evacuation information<br>• Comfort items and continuity planning<br>• Immediate protection screening and Case management' },
                uk: { label: 'Процес евакуації', tag: 'Подорож', context: 'Проведення евакуації<br><br><b>Типи процесів</b><br>• Евакуація, що проводиться гуманітарними організаціями та державними органами<br>• Організована евакуація через транзитні центри<br>• Самостійна евакуація сімей<br>• Евакуація в надзвичайних ситуаціях під час активних бойових дій', actions:'<b>Допомога в евакуації, орієнтована на дітей</b><br><b>Збереження сімей</b><br>• Запобігання розлученню сімей під час евакуації<br>• Спільне планування евакуації для сімей<br>• Залучення та підтримка соціальних працівників на різних етапах подорожі<br><br><b>Спеціалізована допомога</b><br>• Доступний транспорт для дітей з інвалідністю<br>• Організація невідкладної допомоги для дітей без супроводу<br><br><b>Заходи захисту дітей</b><br>• Пошук сімей під час евакуації<br>• Спеціальний транспорт для дітей з інвалідністю<br>• Процедури евакуації, орієнтовані на дітей<br>• Надання мультицільової грошової допомоги сім`ям з дітьми<br>• Інформація про евакуацію, адаптована до віку<br>• Предмети для комфорту та постійних потреб<br>• Негайний скринінг захисту та кейс-менеджмент'}
            }
        },
        {
            id: 'n7', x: 1250, y: 500, w: 180, type: 'red',
            content: {
                en: { label: 'Family separation', tag: 'High Risk Stage', issues: '<b>Family Separation Crisis</b><br><b>Separation Scenarios</b><br>• 36% of households report family separation<br>• Caregivers sending children to safer areas ahead<br>• Fathers unable to evacuate due to conscription rules<br>• Children placed with temporary caregivers<br><b>Protection Risks</b><br>•Increased vulnerability to violence, abuse, neglect<br>• Psychological distress from separation<br>• Risk of trafficking and exploitation<br>• Challenges in family reunification', actions: '<b>Family Tracing & Reunification</b><b><br>Tracing Services</b><br>• Activate family tracing network<br><b>Reunification Support</b>•Safe transport for reunification<br>• Family assessment and support<br>• Post-reunification monitoring<br><b>Communication Services</b><br>• Free communication platforms for families<br>• Message relay services<br>• Regular contact facilitation' },
                uk: { label: 'Розлучення сімей', tag: 'Високий ризик', issues:'<b>Криза розлучення сімей</b><br><b>Сценарії розлучення</b><br>• 36% домогосподарств повідомляють про розлучення сімей<br>• Опікуни відправляють дітей у безпечніші райони<br>• Батьки не можуть евакуюватися через правила призову до армії<br>• Дітей розміщують у тимчасових опікунів<br><br><b>Ризики для захисту</b><br>• Підвищена вразливість до насильства, зловживань, нехтування<br>• Психологічний стрес від розлуки<br>• Ризик торгівлі людьми та експлуатації<br>• Проблеми з возз`єднанням сімей', actions: '<b>Пошук та возз`єднання сімей</b><b><br>Послуги з пошуку</b><br>• Активація мережі пошуку сімей<br><b>Підтримка возз`єднання</b>•Безпечний транспорт для возз`єднання<br>• Оцінка та підтримка сімей<br>• Моніторинг після возз`єднання<br><b>Послуги зв`язку</b><br>• Безкоштовні платформи для спілкування сімей<br>• Послуги з передачі повідомлень<br>• Сприяння регулярному контакту' }
            }
        },
        {
            id: 'n8', x: 1450, y: 620, w: 180, type: 'red',
            content: {
                en: { label: 'Institutional Care', tag: 'High Risk Stage', issues: '<b>Children in Institutional Care</b><br><b>Current Scale</b><br>• 26,000 children live in 720 institutions<br>• Over 2,000 children from institutions evacuated<br>• 3,188 children returned to Ukraine from abroad<br>• 1,047 returned to residential care (not families)<br><b>System Challenges</b><br>•War is institutionalizing more children<br>• Overreliance on institutional vs family-based care<br>• Absence of sufficient foster families<br>• Risk of prolonged institutionalization', actions: '<b>Alternative Care System Response (Better Care)</b><br><b>Family-Based Alternative Care</b>•Foster family recruitment and training<br>• Emergency foster care availability<br>• Kinship care support programs<br><b>Reunification and Reintegration</b><br>•Safe, individually assessment return and reintegration of evacuated/returning children<br>• Temporary “Family Home Services” in communities<br>• Family reunification where safe<br><b>Social services and support for children in placement</b><br>• Regular monitoring and support for placements<br>• Specialized care for children with disabilities<br>• Trauma informed care for children<br><b>Prevention of Separation</b><br>• Family support and access to prevention services<br>• Early intervention for at-risk families' },
                uk: { label: 'Інституційний догляд', tag: 'Високий ризик', issues: '<b>Діти в закладах інтернатного типу</b><br>Поточний масштаб<br>• 26 000 дітей проживають у 720 закладах<br>• Понад 2 000 дітей евакуйовано з закладів<br>• 3 188 дітей повернулися в Україну з-за кордону<br>• 1 047 повернулися до закладів інтернатного типу (не в сім`ї)<br><b>Проблеми системи</b><br>• Війна призводить до інтернатизації більшої кількості дітей<br>• Надмірна залежність від інтернатних закладів замість сімейного виховання<br>• Відсутність достатньої кількості прийомних сімей<br>• Ризик тривалої інтернатизації', actions: '<b>Альтернативна система догляду (кращий догляд)</b><br><b>Альтернативний догляд на основі сім`ї</b>•Набір та навчання прийомних сімей<br>• Наявність екстреної опіки<br>• Програми підтримки опіки родичами<br><b>Возз`єднання та реінтеграція</b><br>• Безпечне, індивідуально оцінене повернення та реінтеграція евакуйованих/повертаючихся дітей<br>• Тимчасові «послуги сімейного дому» в громадах<br>• Возз`єднання сімей у безпечних умовах<br><b>Соціальні послуги та підтримка для дітей, які перебувають під опікою</b><br>• Регулярний моніторинг та підтримка для дітей, які перебувають під опікою<br>• Спеціалізована допомога для дітей з інвалідністю<br>• Допомога дітям, які пережили травму<br><b>Запобігання розлученню</b><br>• Підтримка сімей та доступ до послуг із запобігання розлученню<br>• Раннє втручання для сімей, які перебувають у зоні ризику'}
            }
        },
        {
            id: 'n9', x: 780, y: 570, w: 180, type: 'blue',
            content: {
                en: { label: 'Transit Centers', tag: 'Journey', context: '<b>Transit Centers & Early Reception</b><br><b>Current Situation</b><br>• 17.7% of residents are children<br>• Overcrowded conditions in many sites<br>• Only 25% have disability-friendly facilities<br>• Limited child-friendly spaces<br>• Inadequate WASH facilities in some sites (and risk of infectious diseases)', actions: '<b>Immediate Needs</b><br>• Safe spaces for play and learning<br>• Family tracing and communication<br>• Psychosocial support and counseling<br>• Child protection case management<br>• Cash assistance for families with children<br>• WASH facilities in transit and collective centers<br>• Hygiene items' },
                uk: { label: 'Транзитні центри', tag: 'Подорож', context: '<b>Транзитні центри та центри первинного прийому</b><br><b>Поточна ситуація</b><br>• 17,7 % мешканців – діти<br>• Переповненість у багатьох місцях<br>• Лише 25 % мають зручності для людей з інвалідністю<br>• Обмежена кількість приміщень, придатних для дітей<br>• Недостатні санітарні умови в деяких місцях (та ризик інфекційних захворювань)',actions: '<b>Нагальні потреби</b><br>• Безпечні місця для ігор та навчання<br>• Пошук та зв`язок із родичами<br>• Психосоціальна підтримка та консультування<br>• Управління справами щодо захисту дітей<br>• Грошова допомога сім`ям з дітьми<br>• Обладнання для водопостачання, санітарії та гігієни в транзитних та колективних центрах<br>• Предмети гігієни' }
            }
        },
        {
            id: 'n10', x: 1120, y: 570, w: 180, type: 'blue',
            content: {
                en: { label: 'Community Living', tag: 'Journey', context:'<b>Community-Based Living</b><br><b>Living Situation</b><br>• 85% of evacuees move to community settings<br>• 60% of IDPs have rental costs in monthly expenses<br>• 31% spend over 70% of income on housing<br>• Many live without formal rental agreements<br><b>Integration Challenges</b><br>• Fear of eviction and housing insecurity<br>• Access to offline education and quality healthcare<br>• Social integration and peer relationships<br>• Economic pressure on families'},
                uk: { label: 'Проживання в громаді', tag: 'Подорож', context: '<b>Життя в громаді</b><br><b>Житлові умови</b><br>• 85% евакуйованих переїжджають до громадських помешкань<br>• 60% внутрішньо переміщених осіб мають витрати на оренду в щомісячних витратах<br>• 31% витрачають понад 70% доходу на житло<br>• Багато хто живе без офіційних договорів оренди<br><b>Проблеми інтеграції</b><br>• Страх виселення та нестабільність житлових умов<br>• Доступ до офлайн-освіти та якісної медичної допомоги<br>• Соціальна інтеграція та відносини з однолітками<br>• Економічний тиск на сім`ї'}
            }
        },
        {
            id: 'n11', x: 780, y: 700, w: 180, type: 'red',
            content: {
                en: { label: 'Collective sites', tag: 'High Risk Stage', issues: '<b>Protracted Stay in Collective Sites</b><br><b>Long-term Challenges</b><br>• 81% of residents displaced for 18+ months<br>•88% indicate intention to remain<br>• 72% cite housing affordability as barrier to leaving<br>• Poor living conditions and limited privacy<br><b>Child-Specific Risks</b><br>• Exposure to unsafe, overcrowded conditions with high risk of disease outbreaks<br>• Limited access to child-friendly services including health care<br>• Educational disruption and social isolation – 45% of parents indicate negative consequences of displacement on their children`s education<br>• Increased risk of violence and exploitation', actions: '<b>Community Integration Support</b><br><b>Housing and Cash Assistance</b><br>• Multipurpose cash assistance<br>• Legal aid support for families, including against eviction<br><b>Educational Continuity</b><br>• School enrollment support<br>• Catch-up/remedial education programs<br>• Language and integration support<br><b>Social Inclusion</b><br>• Community integration activities<br>• Peer support networks for children<br><b>Economic Support</b><br>• Family livelihood programs<br>• Positive Parenting and Skills training for parents<br>• Child care support for working parents' },
                uk: { label: 'Колективні центри', tag: 'Високий ризик', issues: '<b>Тривале перебування в колективних місцях проживання</b><br>Довгострокові виклики<br>•81% мешканців переміщені протягом 18+ місяців<br>•88% висловлюють намір залишитися<br>•72% називають доступність житла перешкодою для виїзду<br>•Погані умови проживання та обмежена приватність<br><b>Ризики, пов`язані з дітьми</b><br>• Навколишнє середовище є небезпечним, переповненим, з високим ризиком спалахів захворювань<br>• Обмежений доступ до послуг, орієнтованих на дітей, включаючи медичне обслуговування<br>• Переривання навчання та соціальна ізоляція – 45% батьків вказують на негативні наслідки переміщення для освіти своїх дітей<br>• Підвищений ризик насильства та експлуатації', actions: '<b>Підтримка інтеграції в громаду</b><br><b>Житлова та грошова допомога</b><br>• Багатоцільова грошова допомога<br>• Юридична допомога сім`ям, зокрема у випадках виселення<br><b>Безперервність освіти</b><br>• Допомога у вступі до школи<br>• Програми наздоганяючого/корекційного навчання<br>• Мовна та інтеграційна підтримка<br><b>Соціальна інклюзія</b><br>• Заходи з інтеграції в громаду<br>• Мережі підтримки однолітків для дітей<br><b>Економічна підтримка</b><br>• Програми забезпечення засобів до існування для сімей<br>• Навчання батьків позитивним методам виховання та навичкам<br>• Допомога з доглядом за дітьми для працюючих батьків'}
            }
        },
        {
            id: 'n12', x: 700, y: 830, w: 400, type: 'red', className: 'wide',
            content: {
                en: { label: 'Protracted displacement', tag: 'High Risk Stage', issues: '<b>Long-term Displacement Impacts</b><br><br><b>Mental Health Crisis</b><br>• 43% of children in programs show psychosocial distress<br>• 1.5 million children at risk of depression/PTSD<br>• 1 in 5 children lost a close relative or friend<br>• 84% of households identify distress as overwhelming risk, actions<br><b>Emerging Threats</b><br>• Online recruitment and exploitation<br>• Russian Federation grooming children via social media<br>• 4,476 children victims of crimes (Jan-July 2025)<br>• Justice system treating children punitively vs protectively<br>• 70% face acute material deprivation<br><b>Educational Impact</b><br>• 1.2 million children missing full-time learning<br>• 65% of frontline children in online schooling<br>• Digital divide affecting access<br><br><b>Gender-Specific Risks for Girls and Women</b><br><b>Sexual Exploitation & Trafficking</b>• 76% of trafficking cases involve labor exploitation<br>• Risk of trafficking for sexual exploitation documented<br>• Economic desperation increasing survival sex risks<br>• Vulnerability along evacuation routes<br><b>Technology-Facilitated Violence</b><br>• Online grooming and sexual exploitation<br>• Digital harassment and abuse<br>• Unsupervised online learning increasing exposure<br>• Recruitment through social media platforms<br><b>Movement & Safety Restrictions</b><br>• Women and girls feel less safe outside home<br>• Absence of public street lighting restricts movement<br>• Collective housing creating vulnerabilities<br>• Risk from substance abuse in communities', actions: '<b>Mental Health & Psychosocial Support</b><br><b>Community-Based and Family Support</b><br>• Peer support groups for children and adolescents<br>• Resilience Services, including positive parenting<br>• Individual and group therapy and counseling<br>• Support groups for displaced families<br><b>Child-Friendly Justice</b><br><b>Victim-Centered Approach</b><br>• Treat recruited children as victims, not criminals<br>• Free specialized legal aid for children<br>• Child-sensitive court procedures<br>• Protection from harsh punishments for recruited children<br>• Alternatives to Detention<br>• Reintegration Support<br><b>Learning Recovery</b><br>• Catch up/remedial education<br>• Ensuring availability of inclusive education<br><b>School-Based MHPSS Services</b><br>• School counselors and psychologists<br>• Teacher training on trauma-informed approaches<br>• Classroom-based social-emotional learning<br><br><b>Girls-Focused Protection Interventions</b><br><b>GBV Prevention & Response</b><br>• Specialized GBV case management<br>• Legal aid and justice support<br>• Safe reporting mechanisms<br>• Survivor-centered services'},




                uk: { label: 'Затяжне переміщення', tag: 'Високий ризик', issues: '<b>Довгострокові наслідки переміщення</b><br><br><b>Криза психічного здоров`я</b><br>• 43% дітей, які беруть участь у програмах, демонструють психосоціальний дистрес<br>• 1,5 мільйона дітей перебувають у зоні ризику депресії/ПТСР<br>• 1 з 5 дітей втратив близького родича або друга<br>• 84% домогосподарств вважають дистрес надзвичайним ризиком, дії<br><b>Нові загрози</b><br>• Рекрутинг та експлуатація в Інтернеті<br>• Російська Федерація вербує дітей через соціальні мережі<br>• 4476 дітей стали жертвами злочинів (січень-липень 2025 року)<br>• Система правосуддя ставиться до дітей карально, а не захисно<br>• 70% дітей стикаються з гострою матеріальною скрутою<br><b>Вплив на освіту</b><br>• 1,2 мільйона дітей не мають можливості навчатися на денній формі<br>• 65% дітей, які перебувають на передовій, навчаються онлайн<br>• Цифровий розрив впливає на доступ до освіти<br><br><b>Гендерні ризики для дівчат і жінок</b><br><b>Сексуальна експлуатація та торгівля людьми</b>• 76% випадків торгівлі людьми пов`язані з трудовою експлуатацією<br>• Документально підтверджений ризик торгівлі людьми з метою сексуальної експлуатації<br>• Економічна безвихідь збільшує ризики сексуального виживання<br>• Вразливість на шляхах евакуації<br><b>Насильство, що сприяє розвитку технологій</b><br>• Онлайн-грумінг та сексуальна експлуатація<br>• Цифрове переслідування та зловживання<br>• Неконтрольоване онлайн-навчання збільшує ризик<br>• Вербування через соціальні мережі<br><b>Обмеження пересування та безпеки</b><br>• Жінки та дівчата почуваються менш безпечно поза домом<br>• Відсутність вуличного освітлення обмежує пересування<br>• Колективне житло створює вразливість<br>• Ризик зловживання наркотичними речовинами в громадах', actions: '<b>Психічне здоров`я та психосоціальна підтримка</b><br><b>Підтримка на рівні громади та сім`ї</b><br>• Групи взаємодопомоги для дітей та підлітків<br>• Послуги з розвитку стійкості, включаючи позитивне виховання дітей<br>• Індивідуальна та групова терапія та консультування<br>• Групи підтримки для переміщених сімей<br><b>Дитяча юстиція</b><br><b>Підхід, орієнтований на жертву</b><br>•Ставитися до дітей-рекрутів як до жертв, а не злочинців<br>• Безкоштовна спеціалізована правова допомога для дітей<br>• Судові процедури, що враховують інтереси дітей<br>• Захист від суворих покарань для дітей-рекрутів<br>• Альтернативи ув`язненню<br>• Підтримка реінтеграції<br><b>Відновлення навчання</b><br>• Надолуження/корекційна освіта<br>• Забезпечення доступності інклюзивної освіти<br><b>Шкільні послуги з психічного здоров`я та соціальної підтримки</b>• Шкільні консультанти та психологи<br>• Підготовка вчителів з підходів, що враховують травматичний досвід<br>• Соціально-емоційне навчання в класі<br><br><b>Заходи захисту, орієнтовані на дівчат</b><br><b>Запобігання та реагування на гендерне насильство</b><br>• Спеціалізоване ведення випадків гендерного насильства<br>• Юридична допомога та підтримка у судових процесах<br>• Механізми безпечного повідомлення про випадки насильства<br>• Послуги, орієнтовані на жертв насильства'}
            }
        },
        {
            id: 'n13', x: 500, y: 960, w: 180, type: 'yellow',
            content: {
                en: { label: 'Post-displacement', tag: 'Decision Point', context: 'Strategic decision making regarding future settlement.', actions: 'Planning for durable solutions.' },
                uk: { label: 'Після переміщення', tag: 'Точка прийняття рішення', context: 'Стратегічне прийняття рішень щодо майбутнього розселення.', actions: 'Планування довгострокових рішень.' }
            }
        },
        {
            id: 'n14', x: 200, y: 1090, w: 180, type: 'red',
            content: {
                en: { label: 'Return to Risk', tag: 'Outcome', issues: '<b>Return to Unsafe Areas</b><br><b>Return Motivations</b><br>• 18% return due to inability to earn income in displacement<br>• 25% cite lack of affordable housing<br>• Family reunification needs<br>• Property monitoring and asset protection<br><b>Child-Specific Risks</b><br>• Re-exposure to active hostilities<br>• Limited access to education and healthcare<br>• Family separation if women return alone<br>• Continued trauma and stress'},
                uk: { label: 'Повернення до ризику', tag: 'Результат', issues: '<b>Повернення в небезпечні райони</b><br><b>Мотиви повернення</b><br>• 18% повертаються через неможливість заробляти на життя в умовах переміщення<br>• 25% вказують на відсутність доступного житла<br>• Потреба в возз`єднанні сім`ї<br>• Контроль за майном та захист активів<br><b>Ризики, пов`язані з дітьми</b><br>• Повторне потрапляння в зону бойових дій<br>• Обмежений доступ до освіти та охорони здоров`я<br>• Розлучення з родиною, якщо жінки повертаються самі<br>• Тривала травма та стрес' }
            }
        },
        {
            id: 'n15', x: 800, y: 1090, w: 180, type: 'blue',
            content: {
                en: { label: 'Local integration', tag: 'Outcome', context: '<b>Success Factors</b><br>• Strong community support systems<br>• Adequate and affordable housing<br>• Quality social services<br>• Educational continuity and support', actions: '<b>Positive Outcomes</b><br>•Stable housing and community connections<br>• Access to quality education and healthcare, safe water & sanitation, and heating<br>• Enrollment in social protection schemes, as relevant<br>• Social integration and peer relationships<br>• Economic stability for families' },
                uk: { label: 'Місцева інтеграція', tag: 'Результат', context: '<b>Фактори успіху</b><br>• Сильні системи підтримки громади<br>• Адекватне та доступне житло<br>• Якісні соціальні послуги<br>• Безперервність та підтримка освіти', actions: '<b>Позитивні результати</b><br>• Стабільне житло та зв`язки з громадою<br>• Доступ до якісної освіти та охорони здоров`я, безпечної води та санітарії, опалення<br>• Участь у програмах соціального захисту, за необхідності<br>• Соціальна інтеграція та стосунки з однолітками<br>• Економічна стабільність для сімей'}
            }
        }
    ];

    const connections = [
        { from: 'n1', to: 'n2', type: 'straight' },
        { from: 'n2', to: 'n3', type: 'straight' },
        { from: 'n3', to: 'n4', type: 'fork-left-far' },
        { from: 'n3', to: 'n5', type: 'fork-left-near' },
        { from: 'n3', to: 'n6', type: 'fork-right-near' },
        { from: 'n6', to: 'n9', type: 'fork-down-left' },
        { from: 'n6', to: 'n10', type: 'fork-down-right' },
        { from: 'n6', to: 'n7', type: 'side-dotted' },
        { from: 'n7', to: 'n8', type: 'side-dotted-down' },
        { from: 'n9', to: 'n11', type: 'straight' },
        { from: 'n10', to: 'n12', type: 'ortho-deep' },
        { from: 'n11', to: 'n12', type: 'elbow-in' },
        { from: 'n12', to: 'n13', type: 'elbow-left-step' },
        { from: 'n13', to: 'n14', type: 'fork-left-btm' },
        { from: 'n13', to: 'n15', type: 'fork-right-btm' }
    ];

    // --- INIT ---
    function init() {
        renderNodes();
        drawConnectors();
        fitToScreen();
    }

    function renderNodes() {
        const container = document.getElementById('node-container');
        container.innerHTML = ''; 

        data.forEach(n => {
            const el = document.createElement('div');
            el.className = `node ${n.type} ${n.className || ''}`;
            el.id = n.id;
            el.style.left = n.x + 'px';
            el.style.top = n.y + 'px';
            el.style.width = n.w + 'px';
            el.innerHTML = n.content[currentLang].label;
            
            const activate = (e) => {
                e.preventDefault();
                e.stopPropagation();
                openPanel(n);
            };
            el.addEventListener('click', activate);
            el.addEventListener('touchstart', activate, {passive: false});

            container.appendChild(el);
        });
    }

    function drawConnectors() {
        const layer = document.getElementById('svg-layer');
        const paths = layer.querySelectorAll('path');
        paths.forEach(p => p.remove());

        connections.forEach(conn => {
            const start = data.find(n => n.id === conn.from);
            const end = data.find(n => n.id === conn.to);
            if(!start || !end) return;

            const startX = start.x + (start.w / 2);
            const startY = start.y + 54; 
            const endX = end.x + (end.w / 2);
            const endY = end.y;

            let d = '';
            if (conn.type === 'straight') d = `M ${startX} ${startY} L ${endX} ${endY - 4}`;
            else if (conn.type.includes('fork-left')) { const midY = startY + 25; d = `M ${startX} ${startY} L ${startX} ${midY} L ${endX} ${midY} L ${endX} ${endY - 4}`; }
            else if (conn.type.includes('fork-right')) { const midY = startY + 25; d = `M ${startX} ${startY} L ${startX} ${midY} L ${endX} ${midY} L ${endX} ${endY - 4}`; }
            else if (conn.type.includes('fork-down')) { const midY = endY - 25; d = `M ${startX} ${startY} L ${startX} ${midY} L ${endX} ${midY} L ${endX} ${endY - 4}`; }
            else if (conn.type === 'ortho-deep') { const deepY = 790; d = `M ${startX} ${startY} L ${startX} ${deepY} L ${endX + 80} ${deepY} L ${endX + 80} ${endY - 4}`; }
            else if (conn.type === 'elbow-in') { const midY = (startY + endY)/2; d = `M ${startX} ${startY} L ${startX} ${midY} L ${endX} ${midY} L ${endX} ${endY - 4}`; }
            else if (conn.type === 'elbow-left-step') { d = `M ${startX} ${startY} L ${startX} ${endY - 25} L ${endX} ${endY - 25} L ${endX} ${endY - 4}`; }
            else if (conn.type === 'side-dotted') { const sRx = start.x + start.w; const sRy = start.y + 27; const eLx = end.x; const eLy = end.y + 27; d = `M ${sRx} ${sRy} C ${sRx+50} ${sRy}, ${eLx-50} ${eLy}, ${eLx - 4} ${eLy}`; }
            else if (conn.type === 'side-dotted-down') { const sRx = start.x + start.w; const sRy = start.y + 27; const eLx = end.x; const eLy = end.y + 27; d = `M ${sRx} ${sRy} L ${eLx - 30} ${sRy} L ${eLx - 30} ${eLy} L ${eLx - 4} ${eLy}`; }
            else if (conn.type === 'fork-left-btm') { const midY = endY - 25; d = `M ${startX} ${startY} L ${startX} ${midY} L ${endX} ${midY} L ${endX} ${endY - 4}`; }
            else if (conn.type === 'fork-right-btm') { const midY = endY - 25; d = `M ${startX} ${startY} L ${startX} ${midY} L ${endX} ${midY} L ${endX} ${endY - 4}`; }

            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", d);
            path.setAttribute("class", "edge " + (conn.type.includes('dotted') ? "dotted" : ""));
            path.setAttribute("marker-end", "url(#arrow)");
            layer.appendChild(path);
        });
    }

    // --- PAN / ZOOM ---
    const layer = document.getElementById('transform-layer');
    const viewport = document.getElementById('viewport');
    let isDragging = false, startX, startY;

    function updateTransform() {
        layer.style.transform = `translate(${pX}px, ${pY}px) scale(${scale})`;
    }

    function fitToScreen() {
        const w = window.innerWidth;
        const h = window.innerHeight;
        scale = Math.min(w / 1600, h / 1200);
        if (scale > 1) scale = 1;
        if (scale < 0.3) scale = 0.3;
        pX = (w - (1500 * scale)) / 2;
        pY = 50 * scale;
        updateTransform();
    }

    viewport.addEventListener('mousedown', e => { isDragging=true; startX=e.clientX-pX; startY=e.clientY-pY; });
    window.addEventListener('mouseup', () => isDragging=false);
    window.addEventListener('mousemove', e => { if(!isDragging) return; e.preventDefault(); pX=e.clientX-startX; pY=e.clientY-startY; updateTransform(); });
    viewport.addEventListener('touchstart', e => { if(e.touches.length===1){isDragging=true; startX=e.touches[0].clientX-pX; startY=e.touches[0].clientY-pY;} }, {passive:false});
    window.addEventListener('touchend', () => isDragging=false);
    window.addEventListener('touchmove', e => { if(!isDragging) return; e.preventDefault(); pX=e.touches[0].clientX-startX; pY=e.touches[0].clientY-startY; updateTransform(); }, {passive:false});
    window.zoom = f => { scale *= f; updateTransform(); };

    // --- APP LOGIC ---
    function setLanguage(lang) {
        currentLang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.textContent === lang.toUpperCase()));
        document.getElementById('headerTitle').innerHTML = (lang === 'en') ? "A <span style=\"color: rgb(0, 195, 255);\">Child's</span> Journey - HNRP IDP Journey Map" : "Подорож <span style=\"color: rgb(0, 195, 255);\">дитини</span> - Карта шляху ВПО";
        renderNodes();
        closePanel();
    }

    function openPanel(nodeData) {
        const content = nodeData.content[currentLang];
        document.getElementById('pTitle').innerText = content.label;
        document.getElementById('pTag').innerText = content.tag;
        
        const tag = document.getElementById('pTag');
        if(nodeData.type === 'blue') tag.style.background = '#3498db';
        else if(nodeData.type === 'red') tag.style.background = '#e74c3c';
        else if(nodeData.type === 'yellow') tag.style.background = '#f1c40f';
        else if(nodeData.type === 'purple') tag.style.background = '#8e44ad';

        const body = document.getElementById('pBody');
        body.innerHTML = '';

        if (content.issues) {
            const box = document.createElement('div');
            box.className = 'info-box box-issue';
            box.innerHTML = `<h4>${currentLang==='en'?'Issues & Risks':'Проблеми та Ризики'}</h4>${content.issues}`;
            body.appendChild(box);
        }
        if (content.actions) {
            const box = document.createElement('div');
            box.className = 'info-box box-action';
            box.innerHTML = `<h4>${currentLang==='en'?'Response':'Реагування'}</h4>${content.actions}`;
            body.appendChild(box);
        }
        if (content.context) {
            const box = document.createElement('div');
            box.className = 'info-box box-context';
            box.innerHTML = `<h4>${currentLang==='en'?'Context':'Контекст'}</h4>${content.context}`;
            body.appendChild(box);
        }

        document.getElementById('sidePanel').classList.add('open');
    }

    window.closePanel = () => document.getElementById('sidePanel').classList.remove('open');

    init();

</script>
</body>
</html>
